



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Notes about various topics, courses, books, etc.">
      
      
        <link rel="canonical" href="https://marcolabarile.me/notes/building-microservices/deployment/">
      
      
        <meta name="author" content="Marco Labarile">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon-16x16.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Deployment - Marco Labarile - Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../assets/styles/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-117745201-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#deployment" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://marcolabarile.me/notes/" title="Marco Labarile - Notes" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Marco Labarile - Notes
            </span>
            <span class="md-header-nav__topic">
              
                Deployment
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/labarilem/notes" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    labarilem/notes
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://marcolabarile.me/notes/" title="Marco Labarile - Notes" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Marco Labarile - Notes
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/labarilem/notes" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    labarilem/notes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      OAuth 2.0 and OpendID Connect
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        OAuth 2.0 and OpendID Connect
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../oauth2-and-openid-connect/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../oauth2-and-openid-connect/jwt/" title="JWT (JSON Web Token)" class="md-nav__link">
      JWT (JSON Web Token)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../oauth2-and-openid-connect/oauth2/" title="OAuth 2.0" class="md-nav__link">
      OAuth 2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../oauth2-and-openid-connect/openid-connect/" title="OpenID Connect" class="md-nav__link">
      OpenID Connect
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Building microservices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Building microservices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microservices/" title="Microservices" class="md-nav__link">
      Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../evolutionary-architects/" title="Evolutionary architects" class="md-nav__link">
      Evolutionary architects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../how-to-model-services/" title="How to model services" class="md-nav__link">
      How to model services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../integration/" title="Integration" class="md-nav__link">
      Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../splitting-the-monolith/" title="Splitting the monolith" class="md-nav__link">
      Splitting the monolith
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Deployment
      </label>
    
    <a href="./" title="Deployment" class="md-nav__link md-nav__link--active">
      Deployment
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mapping-continuous-integration-to-microservices" class="md-nav__link">
    Mapping Continuous Integration to Microservices
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-repository-and-single-build" class="md-nav__link">
    Single repository and single build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-repository-and-multiple-builds" class="md-nav__link">
    Single repository and multiple builds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-repositories-and-multiple-builds" class="md-nav__link">
    Multiple repositories and multiple builds
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-pipelines-and-continuous-delivery" class="md-nav__link">
    Build Pipelines and Continuous Delivery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exceptions-to-continuous-delivery" class="md-nav__link">
    Exceptions to Continuous Delivery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#platform-specific-artifacts" class="md-nav__link">
    Platform-Specific Artifacts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operating-system-artifacts" class="md-nav__link">
    Operating System Artifacts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-images" class="md-nav__link">
    Custom images
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#images-as-artifacts" class="md-nav__link">
    Images as Artifacts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#immutable-servers" class="md-nav__link">
    Immutable Servers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environments" class="md-nav__link">
    Environments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-configuration" class="md-nav__link">
    Service configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-to-host-mapping" class="md-nav__link">
    Service-to-Host Mapping
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiple-services-per-host" class="md-nav__link">
    Multiple Services Per Host
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-containers" class="md-nav__link">
    Application Containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-service-per-host" class="md-nav__link">
    Single Service per Host
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation" class="md-nav__link">
    Automation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#from-physical-to-virtual" class="md-nav__link">
    From Physical to Virtual
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#traditional-virtualization" class="md-nav__link">
    Traditional Virtualization
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vagrant" class="md-nav__link">
    Vagrant
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-containers" class="md-nav__link">
    Linux containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-deployment-interface" class="md-nav__link">
    A Deployment Interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../conway/" title="Conway's Law and System Desing" class="md-nav__link">
      Conway's Law and System Desing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microservices-at-scale/" title="Microservices at Scale" class="md-nav__link">
      Microservices at Scale
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../conclusion/" title="Bringing It All Together" class="md-nav__link">
      Bringing It All Together
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Bitcoin and cryptocurrency technologies
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Bitcoin and cryptocurrency technologies
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/crypto-hash-functions/" title="Cryptographic hash functions" class="md-nav__link">
      Cryptographic hash functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/digital-signature/" title="Digital signature" class="md-nav__link">
      Digital signature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/hash-pointers-and-data-structures/" title="Hash pointers" class="md-nav__link">
      Hash pointers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/centralization-vs-decentralization/" title="Centralization and decentralization" class="md-nav__link">
      Centralization and decentralization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/distributed-consensus/" title="Distributed consensus" class="md-nav__link">
      Distributed consensus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mapping-continuous-integration-to-microservices" class="md-nav__link">
    Mapping Continuous Integration to Microservices
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-repository-and-single-build" class="md-nav__link">
    Single repository and single build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-repository-and-multiple-builds" class="md-nav__link">
    Single repository and multiple builds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-repositories-and-multiple-builds" class="md-nav__link">
    Multiple repositories and multiple builds
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-pipelines-and-continuous-delivery" class="md-nav__link">
    Build Pipelines and Continuous Delivery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exceptions-to-continuous-delivery" class="md-nav__link">
    Exceptions to Continuous Delivery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#platform-specific-artifacts" class="md-nav__link">
    Platform-Specific Artifacts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operating-system-artifacts" class="md-nav__link">
    Operating System Artifacts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-images" class="md-nav__link">
    Custom images
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#images-as-artifacts" class="md-nav__link">
    Images as Artifacts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#immutable-servers" class="md-nav__link">
    Immutable Servers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environments" class="md-nav__link">
    Environments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-configuration" class="md-nav__link">
    Service configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-to-host-mapping" class="md-nav__link">
    Service-to-Host Mapping
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiple-services-per-host" class="md-nav__link">
    Multiple Services Per Host
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-containers" class="md-nav__link">
    Application Containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-service-per-host" class="md-nav__link">
    Single Service per Host
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automation" class="md-nav__link">
    Automation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#from-physical-to-virtual" class="md-nav__link">
    From Physical to Virtual
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#traditional-virtualization" class="md-nav__link">
    Traditional Virtualization
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vagrant" class="md-nav__link">
    Vagrant
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-containers" class="md-nav__link">
    Linux containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-deployment-interface" class="md-nav__link">
    A Deployment Interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h1>
<p>Deployment in microservices differs from monolithic systems. It's important to have a working approach following the continuous integration and delivery practices.</p>
<h2 id="mapping-continuous-integration-to-microservices">Mapping Continuous Integration to Microservices<a class="headerlink" href="#mapping-continuous-integration-to-microservices" title="Permanent link">&para;</a></h2>
<p>The goal is to be able to deploy microservices independently.
So, how to map microservices to builds and code repositories? We have different options:</p>
<h3 id="single-repository-and-single-build">Single repository and single build<a class="headerlink" href="#single-repository-and-single-build" title="Permanent link">&para;</a></h3>
<p>Use a single repository to store all our code, and have a single build, triggered on every code integration, that produces every build artifact we need.</p>
<p>Benefits:</p>
<ul>
<li>Easy to implement.</li>
<li>Easy to commit changes.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>A small change to a single service will trigger builds we do not need.</li>
<li>What services do we need to deploy? Hard to determine which services changed by only looking at the pushed commit.</li>
<li>If a commit breaks the build, the build needs to be fixed before any other team can push code in the repository, locking those teams.</li>
</ul>
<h3 id="single-repository-and-multiple-builds">Single repository and multiple builds<a class="headerlink" href="#single-repository-and-multiple-builds" title="Permanent link">&para;</a></h3>
<p>A variation of the previous approach is to have a single repository but setup multiple CI builds mapping to parts of the source code.</p>
<p>Benefits:</p>
<ul>
<li>Easy to commit changes.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>Developers can get into the habit of making changes to different services in the same commit.</li>
</ul>
<h3 id="multiple-repositories-and-multiple-builds">Multiple repositories and multiple builds<a class="headerlink" href="#multiple-repositories-and-multiple-builds" title="Permanent link">&para;</a></h3>
<p>Each microservice has its own repository and CI build.</p>
<p>Benefits:</p>
<ul>
<li>Only needed builds and tests are run when the build is triggered.</li>
<li>A team can own the repository that it's working on.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>Making changes across microservices is more difficult, but this is still preferable to the single repository approach.</li>
</ul>
<h2 id="build-pipelines-and-continuous-delivery">Build Pipelines and Continuous Delivery<a class="headerlink" href="#build-pipelines-and-continuous-delivery" title="Permanent link">&para;</a></h2>
<p>In build processes usually there are a lot of fast, small-scoped tests, and a few large-scoped, slow tests. We will not get fast feedback when our fast tests fail if we're waiting for the other tests to finish. Also, if the fast tests fail, there is no need to run other tests.</p>
<p>A solution to this problem is to have different stages in our build, i.e. a <strong>build pipeline</strong>.
Build pipelines allow to track the software as it goes through each build stage, giving a clear idea of its stability.</p>
<p>In <em>continuous delivery</em> (<em>CD</em>) we get constant feedback on the production readiness of each and every check-in, and treat each and every check-in as a release candidate. So clearly <em>CD</em> benefits from build pipelines.
In microservices with CI, we want one pipeline per service, in which a single artifact will move through our path to production.</p>
<h2 id="exceptions-to-continuous-delivery">Exceptions to Continuous Delivery<a class="headerlink" href="#exceptions-to-continuous-delivery" title="Permanent link">&para;</a></h2>
<p>In the starting stage of a project, a single repository and single build approach may be more convenient since developers are not confident with the domain yet because the service boundaries are likely to change a lot. In this case, having a multi repository model will increase a lot the cost of these changes.
Then, when the development team acquires experience in the domain, it can start moving out services in their own repositories and build pipelines.</p>
<h2 id="platform-specific-artifacts">Platform-Specific Artifacts<a class="headerlink" href="#platform-specific-artifacts" title="Permanent link">&para;</a></h2>
<p>Some artifacts are platform-specific (e.g. JAR files). This means that they need a specific configuration and a specific platform to be run in an environment.
Tools like <a href="https://puppet.com/">Puppet</a> and <a href="https://www.chef.io/">Chef</a> can help to automate this process.</p>
<h2 id="operating-system-artifacts">Operating System Artifacts<a class="headerlink" href="#operating-system-artifacts" title="Permanent link">&para;</a></h2>
<p>Another option for platform-specific artifacts is to use os-specific artifacts. This way, the OS can manage dependencies, installation and removal of your software.</p>
<p>The downside is in actually creating these packages, because the difficulty depends on the target OS (e.g. teams using Windows, not known for package management capabilities, may be unhappy with this approach).</p>
<p>Another downside is that if you need to deploy on different OS, there is an increase in complexity in your build and test process.</p>
<h2 id="custom-images">Custom images<a class="headerlink" href="#custom-images" title="Permanent link">&para;</a></h2>
<p>The problem with tools like Puppet and Chef is that <strong>they take time to provision a machine</strong>. They need to install platforms (e.g. JVM) or perform expensive checks on the system to detect if a valid platform version is already installed.</p>
<p>And if we're using an on-demand compute platform we might be constantly shutting down and spinning up new instances frequently, making the time cost of these tools really high.</p>
<p>If you need to install the same tools multiple times per day (e.g. because of CI) this becomes a real problem in terms of providing fast feedback. It can also lead to increased downtime when deploying in production if your systems do not allow zero-downtime deployment (<em>blue/green deployment</em> can help mitigate this issue).</p>
<p>One approach to <strong>reducing the provisioning time</strong> is to create a virtual machine image that bakes in some common dependencies we use. When we want to deploy our software, we spin up an instance of this custom image, and all we have to do is install the latest version of our service.</p>
<p>When you launch new copies of this image you don't need to spend time installing your dependencies, as they are already there. This can result in significant time savings.</p>
<p>There are drawbacks too:</p>
<ul>
<li>Build times are increased.</li>
<li>Resulting images can be very large, making it hard to move them across the network.</li>
<li>The image build process differs from platform to platform (e.g. VMWare images, Vagrant images).
  Tools like <a href="https://www.packer.io/">Packer</a> can help.</li>
</ul>
<p>As we'll see later, container technology mitigates these drawbacks.</p>
<h3 id="images-as-artifacts">Images as Artifacts<a class="headerlink" href="#images-as-artifacts" title="Permanent link">&para;</a></h3>
<p>Why stop at including only dependencies in these images? We can also include our software in it.
This will make our software platform agnostic and it is a good way to start implementing the <em>immutable server</em> deployment concept.</p>
<h3 id="immutable-servers">Immutable Servers<a class="headerlink" href="#immutable-servers" title="Permanent link">&para;</a></h3>
<p>To keep our servers immutable we also must be sure that no one is able to access them after they've been deployed (e.g. by disabling <em>SSH</em> in the image artifact).
Otherwise, the configuration could be edited, causing a <em>configuration drift</em>.
If we want to have environments that are easy to reason about, every configuration change must pass through a build pipeline.</p>
<h2 id="environments">Environments<a class="headerlink" href="#environments" title="Permanent link">&para;</a></h2>
<p>Our microservice artifact will move in different environments during the CD pipeline.
Usually these are:</p>
<ol>
<li>Slow tests environment.</li>
<li>UAT environment.</li>
<li>Performance/load test environment.</li>
<li>Production environment.</li>
</ol>
<p>As you go on in the pipeline, you want the environments to look more like the production environment, allowing us to catch production problems before they happen in production.
But consider that production environments are more expensive and slower to set up. So you should balance the ability to find production-like bugs with the ability to get fast feedback from builds.</p>
<h2 id="service-configuration">Service configuration<a class="headerlink" href="#service-configuration" title="Permanent link">&para;</a></h2>
<p>Our services need some configuration (e.g. db username and password). Ideally this should be a small amount of data. Also, it's best to minimize configuration that changes between environments, so that you minimize chances for environment-specific bugs.
But how to handle this kind of configuration?</p>
<ul>
<li>Bundling the configuration in your build artifacts is to be avoided because it violates the principles of <em>CD</em>.
  In this case it would be hard to avoid having sensitive data (e.g. passwords) in your source code.
  Also, build times are increased since you now have more images.
  Then you have to know at build time which environments exist, coupling the build process with the delivery process.</li>
<li>Create a single artifact and place configuration files in environments or use a dedicated system for providing configuration (a popular approach in microservices).</li>
</ul>
<h2 id="service-to-host-mapping">Service-to-Host Mapping<a class="headerlink" href="#service-to-host-mapping" title="Permanent link">&para;</a></h2>
<p>In this era of virtualization, the mapping between a single host running an operating system and the underlying physical infrastructure can vary a lot.</p>
<p>Let's define <em>host</em> to be the generic unit of isolation, i.e. an operating system onto which you can install and run your services.</p>
<p>So how many services per host should we have? There are different options.</p>
<h3 id="multiple-services-per-host">Multiple Services Per Host<a class="headerlink" href="#multiple-services-per-host" title="Permanent link">&para;</a></h3>
<p>Having multiple instances of your service per host.</p>
<p><img alt="Image" src="../images/multiple-services-per-host.png" /></p>
<p>Benefits:</p>
<ul>
<li>Simpler work for the team that manages the infrastructure.</li>
<li>Using host virtualization can add overhead and thus increase costs.</li>
<li>Easier for developers to deploy: a deploy with this setup works like a deploy to a dev machine.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>Make monitoring more difficult (e.g. monitor the host CPU usage or each instance?).</li>
<li>Causes side effects (e.g. when a service is under heavy load, it's likely some other service instances will slow down too).</li>
<li>Need to ensure that a service deployment does not affect other services on the same host.
  Usually this is solved by deploying all service in one step, thus losing ability to deploy independently.</li>
<li>Autonomy of teams is inhibited in case services of different teams are deployed to the same host.</li>
<li>Cannot deploy images and immutable servers.</li>
<li>It can be complicated to target scaling at a service in a host.</li>
<li>If a service handles sensitive data or has different needs (e.g. another network segment), you cannot deploy it with the others.</li>
</ul>
<h3 id="application-containers">Application Containers<a class="headerlink" href="#application-containers" title="Permanent link">&para;</a></h3>
<p>Use an application container (e.g. IIS or Java servlet container) that provides utilities such as management, monitoring and scaling of services.</p>
<p><img alt="Image" src="../images/application-container-deploy.png" /></p>
<p>Benefits:</p>
<ul>
<li>Has too for managing monitoring, scaling and other aspects.</li>
<li>If all services require the same runtime, this approach reduces overhead (e.g. for <em>n</em> Java services only a single JVM instance is needed).</li>
</ul>
<p>Downsides:</p>
<ul>
<li>Technology choice and tools that automate services management are constrained. Losing automation here means having to do a lot of work in managing services.</li>
<li>Usually slow spin-up times, slowing feedback for developers.</li>
<li>Analyzing resources use is hard, as you have multiple applications sharing a single process.</li>
<li>Application containers have their own resource consumption overhead.</li>
</ul>
<h3 id="single-service-per-host">Single Service per Host<a class="headerlink" href="#single-service-per-host" title="Permanent link">&para;</a></h3>
<p>A host contains only a single service.</p>
<p><img alt="Image" src="../images/single-service-per-host-deploy.png" /></p>
<p>Benefits:</p>
<ul>
<li>Easier to monitor resources usage.</li>
<li>Easier to avoid the side effects of having multiple services in a single host.</li>
<li>Reduces complexity of your system.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>More hosts mean more servers to manage and costs might increase.</li>
</ul>
<p>You can mitigate the complexity of managing more hosts by using a <strong>platform as a service</strong> (PaaS). This way, the host management problem is simplified, but you lose control over your hosts.</p>
<p><em>Tip: some PaaS try to automate too much (e.g. automate scaling), making them less effective for your specific use case.</em></p>
<h2 id="automation">Automation<a class="headerlink" href="#automation" title="Permanent link">&para;</a></h2>
<p>Automation is the solution to many of the problems we have raised so far.</p>
<p>One of the pushbacks for switching to single service per host is the perception that the amount of overhead for management will increase. If you do everything manually, it surely will, but automation will prevent this issue.</p>
<p>Automation also allow developers to be productive, especially if they have access to the same technologies used in production because it will help catch bugs early on.</p>
<p>Embracing a culture of automation is key if you want to keep the complexities of microservice architectures in check.</p>
<h2 id="from-physical-to-virtual">From Physical to Virtual<a class="headerlink" href="#from-physical-to-virtual" title="Permanent link">&para;</a></h2>
<p>One of the key tools available to us in managing many hosts is finding ways of chunking up existing physical machines into smaller parts.</p>
<h3 id="traditional-virtualization">Traditional Virtualization<a class="headerlink" href="#traditional-virtualization" title="Permanent link">&para;</a></h3>
<p>Having lots of hosts can be really expensive if you need a physical server per host. By virtualizing you can split a physical machine in separate parts but of course this comes with an overhead.</p>
<p>For example, in <em>Type 2</em> virtualization, the <em>hypervisor</em> sets aside resources for each virtual machine it manages, but these resources could be used for something else instead of being idle and reserved.</p>
<p><img alt="Image" src="../images/type-2-virtualization.png" /></p>
<h4 id="vagrant">Vagrant<a class="headerlink" href="#vagrant" title="Permanent link">&para;</a></h4>
<p>A deployment platform usually employed for development and testing. It allows us to define instructions about how to setup and configure VMs. This makes it easier for you to create production-like environments on your local machine.</p>
<p>One of the downsides is that if we have one service to one VM, you may not be able to bring up your entire system on your local machine.</p>
<h3 id="linux-containers">Linux containers<a class="headerlink" href="#linux-containers" title="Permanent link">&para;</a></h3>
<p>Linux containers, instead of using an hypervisor, create a separate process space in which other processes live.</p>
<p><img alt="Image" src="../images/container-virtualization.png" /></p>
<p>Each container is effectively a subtree of the overall system process tree. These containers can have physical resources allocated to them, something the kernel handles for us.</p>
<p>Benefits:</p>
<ul>
<li>No need for an hypervisor.</li>
<li>Much faster to provision than traditional VMs.</li>
<li>Finer-grained control over assignation of resources.</li>
<li>Since they are lighter than VMs, we can have more containers running on the same host.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>The host OS has to share the same kernel with the base OS.</li>
<li>Not as isolated from other processes as VMs, not suitable for running code you don't trust.</li>
<li>How to expose containers to the outer world? A specific network configuration is needed, something that is usually provided by hypervisors.</li>
</ul>
<h3 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h3>
<p>Docker is a platform built on top of lightweight containers. Docker manages the container provisioning, handles some networking problems and provides its own registry that allows you to store and version Docker applications.</p>
<p>Docker can also alleviate some downsides of running lots of services locally for dev and test purposes, in a more efficient way than Vagrant.</p>
<p>Several technologies are build around the Docker concepts, such as <a href="https://coreos.com/">CoreOS</a>, a stripped-down Linux OS that provides only the essential services to allow Docker to run.</p>
<p>Docker itself doesn’t solve all problems for us. Think of it as a simple PaaS that works on a single machine. If you want tools to help you manage services across multiple Docker instances across multiple machines, you’ll need to look at software such as <a href="https://kubernetes.io/">Kubernetes</a> or CoreOS.</p>
<h2 id="a-deployment-interface">A Deployment Interface<a class="headerlink" href="#a-deployment-interface" title="Permanent link">&para;</a></h2>
<p>Whatever underlying platform or artifacts you use, having a uniform interface to deploy a given service is vital to easily deploy microservices to development, test, production and other environments.</p>
<p>A good way to trigger deployments is via CLI tools, because it can be triggered by other scripts, used in CI and called manually.</p>
<p>We need some information for a deploy:</p>
<ol>
<li>What microservice we want to deploy.</li>
<li>What version of said microservice we want to deploy.</li>
<li>What environment we want our microservice deployed into.</li>
</ol>
<p>For this to work, we need to define in some way what our environments look like. YAML could be a good way of expressing our environments definitions.</p>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Main points collected in this chapter:</p>
<ul>
<li>Maintain the ability to deploy microservices independently.</li>
<li>Separate source code and CI builds for each microservices.</li>
<li>Use a single-service per host/container model. Evaluate the tooling aiming for high levels of automation.</li>
<li>Understand how deployment choices affects developers. Creating tools that make it easy to deploy to different environments helps a lot.</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../splitting-the-monolith/" title="Splitting the monolith" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Splitting the monolith
              </span>
            </div>
          </a>
        
        
          <a href="../testing/" title="Testing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Testing
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/labarilem" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://www.linkedin.com/in/marcolabarile/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>