



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Notes about various topics, courses, books, etc.">
      
      
        <link rel="canonical" href="https://marcolabarile.me/notes/building-microservices/security/">
      
      
        <meta name="author" content="Marco Labarile">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon-16x16.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Security - Marco Labarile - Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-117745201-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#security" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://marcolabarile.me/notes/" title="Marco Labarile - Notes" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Marco Labarile - Notes
            </span>
            <span class="md-header-nav__topic">
              
                Security
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/labarilem/notes" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    labarilem/notes
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://marcolabarile.me/notes/" title="Marco Labarile - Notes" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Marco Labarile - Notes
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/labarilem/notes" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    labarilem/notes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      OAuth 2.0 and OpendID Connect
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        OAuth 2.0 and OpendID Connect
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../oauth2-and-openid-connect/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../oauth2-and-openid-connect/jwt/" title="JWT (JSON Web Token)" class="md-nav__link">
      JWT (JSON Web Token)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../oauth2-and-openid-connect/oauth2/" title="OAuth 2.0" class="md-nav__link">
      OAuth 2.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Building microservices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Building microservices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microservices/" title="Microservices" class="md-nav__link">
      Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../evolutionary-architects/" title="Evolutionary architects" class="md-nav__link">
      Evolutionary architects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../how-to-model-services/" title="How to model services" class="md-nav__link">
      How to model services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../integration/" title="Integration" class="md-nav__link">
      Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../splitting-the-monolith/" title="Splitting the monolith" class="md-nav__link">
      Splitting the monolith
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Security
      </label>
    
    <a href="./" title="Security" class="md-nav__link md-nav__link--active">
      Security
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#authentication-and-authorization" class="md-nav__link">
    Authentication and Authorization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-sign-on" class="md-nav__link">
    Single Sign-On
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-sign-on-gateway" class="md-nav__link">
    Single Sign-On Gateway
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-to-service-authentication-and-authorization" class="md-nav__link">
    Service-to-Service Authentication and Authorization
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#allow-everything-inside-the-perimeter" class="md-nav__link">
    Allow Everything Inside the Perimeter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https-basic-authentication" class="md-nav__link">
    HTTP(S) Basic Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reuse-a-sso-implementation" class="md-nav__link">
    Reuse a SSO implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-certificates" class="md-nav__link">
    Client certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hmac-over-http" class="md-nav__link">
    HMAC over HTTP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-keys" class="md-nav__link">
    API Keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-deputy-problem" class="md-nav__link">
    The deputy problem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#securing-data-at-rest" class="md-nav__link">
    Securing Data at Rest
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-protections" class="md-nav__link">
    Other protections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-human-element" class="md-nav__link">
    The Human Element
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baking-security-in" class="md-nav__link">
    Baking Security In
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../conway/" title="Conway's Law and System Desing" class="md-nav__link">
      Conway's Law and System Desing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../microservices-at-scale/" title="Microservices at Scale" class="md-nav__link">
      Microservices at Scale
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../conclusion/" title="Bringing It All Together" class="md-nav__link">
      Bringing It All Together
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Bitcoin and cryptocurrency technologies
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Bitcoin and cryptocurrency technologies
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/crypto-hash-functions/" title="Cryptographic hash functions" class="md-nav__link">
      Cryptographic hash functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/digital-signature/" title="Digital signature" class="md-nav__link">
      Digital signature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/hash-pointers-and-data-structures/" title="Hash pointers" class="md-nav__link">
      Hash pointers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/centralization-vs-decentralization/" title="Centralization and decentralization" class="md-nav__link">
      Centralization and decentralization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/distributed-consensus/" title="Distributed consensus" class="md-nav__link">
      Distributed consensus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#authentication-and-authorization" class="md-nav__link">
    Authentication and Authorization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-sign-on" class="md-nav__link">
    Single Sign-On
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-sign-on-gateway" class="md-nav__link">
    Single Sign-On Gateway
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-to-service-authentication-and-authorization" class="md-nav__link">
    Service-to-Service Authentication and Authorization
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#allow-everything-inside-the-perimeter" class="md-nav__link">
    Allow Everything Inside the Perimeter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https-basic-authentication" class="md-nav__link">
    HTTP(S) Basic Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reuse-a-sso-implementation" class="md-nav__link">
    Reuse a SSO implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-certificates" class="md-nav__link">
    Client certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hmac-over-http" class="md-nav__link">
    HMAC over HTTP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-keys" class="md-nav__link">
    API Keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-deputy-problem" class="md-nav__link">
    The deputy problem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#securing-data-at-rest" class="md-nav__link">
    Securing Data at Rest
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-protections" class="md-nav__link">
    Other protections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-human-element" class="md-nav__link">
    The Human Element
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baking-security-in" class="md-nav__link">
    Baking Security In
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h1>
<p>We need to be aware of the importance of customers' data in our systems. How can we work out what is <em>enough</em> security to protect that data?</p>
<h2 id="authentication-and-authorization">Authentication and Authorization<a class="headerlink" href="#authentication-and-authorization" title="Permanent link">&para;</a></h2>
<p><strong>Authentication</strong> is the mechanism by which an actor proves that he is who he says he is. The actor who is being authenticated is called <strong>principal</strong>.</p>
<p><strong>Authorization</strong> maps a principal to the action he's allowed to do.</p>
<p>Generally, in monolithic applications, web framework provide all the authentication and authorization functionalities for you. While in distributed systems we aim to authenticate a principal a single time for all microservices.</p>
<h2 id="single-sign-on">Single Sign-On<a class="headerlink" href="#single-sign-on" title="Permanent link">&para;</a></h2>
<p>SSO is a common approach to authentication and authorization.</p>
<p><em>How it works:</em></p>
<p>When a <em>principal</em> tries to access a <em>resource</em>, she is directed to authenticate with an <em>identity provider</em> that may ask her to provide a <em>secret</em>. If the identity provider is satisfied of the secret, it gives information to the service provider, allowing it to decide whether to grant her access to the resource.</p>
<p>The identity provider can be an external (e.g. Google's OpenID Connect service) or internal (common for enterprise platforms).</p>
<p>Common SSO implementations:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language">SAML</a> (SOAP-based standard)</li>
<li><a href="https://en.wikipedia.org/wiki/OpenID_Connect">OpenID Connect</a> (authentication layer on top of OAuth 2.0)</li>
</ul>
<h3 id="single-sign-on-gateway">Single Sign-On Gateway<a class="headerlink" href="#single-sign-on-gateway" title="Permanent link">&para;</a></h3>
<p>Rather than having each microservice communicate with the identity provider, you could add a SSO Gateway to your system:</p>
<p><img alt="Image" src="../images/sso-gateway.png" /></p>
<p>Information about principals can be passed to downstream microservices with HTTP headers.</p>
<p>Benefits:</p>
<ul>
<li>Drastically reduces network usage in your system.</li>
<li>Can be used to terminate HTTPS at this level, run intrusion detection and so on.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>You need to make sure that developers are able to launch microservices behind a SSO gateway to test the system without too much effort.</li>
<li>Could give a false sense of security.</li>
</ul>
<p>A gateway may be able to provide fairly effective coarse-grained authorization using <em>roles</em>. Always prefer coarse over fine-grained authorization. The latter make your system hard to manage and reason about because business rules end up in the identity provider. Instead, these rules should be owned by your microservices.</p>
<h2 id="service-to-service-authentication-and-authorization">Service-to-Service Authentication and Authorization<a class="headerlink" href="#service-to-service-authentication-and-authorization" title="Permanent link">&para;</a></h2>
<p>When talking about programs authenticating with each other, we have several possibilities.</p>
<h3 id="allow-everything-inside-the-perimeter">Allow Everything Inside the Perimeter<a class="headerlink" href="#allow-everything-inside-the-perimeter" title="Permanent link">&para;</a></h3>
<p>Authentication is placed only at the perimeter of the system. Depending on the sensitivity of the data, this approach could be fine.</p>
<p>Benefits:</p>
<ul>
<li>Very easy to implement.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>Should an attacker penetrate the <em>perimeter</em>, you'll end up with major troubles. This can be mitigated by using HTTPS but still the stakes are high.</li>
</ul>
<h3 id="https-basic-authentication">HTTP(S) Basic Authentication<a class="headerlink" href="#https-basic-authentication" title="Permanent link">&para;</a></h3>
<p>HTTP Basic Authentication allows for a client to send username and password in a standard HTTP header. This should normally be used with HTTPS to securely send credentials.</p>
<p>Benefits:</p>
<ul>
<li>Well understood and supported standard.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>You need to manage SSL certificates for your microservices.</li>
<li>The overhead of HTTPS traffic can place additional strain on servers.</li>
<li>SSL encrypted traffic can usually be cached only at service level.</li>
<li>You need to manage user and passwords, either by syncing with an existing identity provider or independently (could cause functionality duplication).</li>
</ul>
<h3 id="reuse-a-sso-implementation">Reuse a SSO implementation<a class="headerlink" href="#reuse-a-sso-implementation" title="Permanent link">&para;</a></h3>
<p>If you already have a SSO gateway implemented, you could reuse it for service-to-service authentication. Microservices should have their own <em>service accounts</em> to authenticate with each other.</p>
<p>Benefits:</p>
<ul>
<li>Reuses existing infrastructure.</li>
<li>With each microservice having its own credentials, it's easy to revoke/restore them if they get compromised.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>You need to write code that supports the SSO implementation of your choice.</li>
<li>You need to securely store the service accounts' credentials.</li>
</ul>
<h3 id="client-certificates">Client certificates<a class="headerlink" href="#client-certificates" title="Permanent link">&para;</a></h3>
<p>Clients can install their own TLS certificates to authenticate to servers. This could be a mandatory choice if your service-to-service traffic goes through networks you don't control (e.g. Internet).</p>
<p>Benefits:</p>
<ul>
<li>Servers have strong guarantee that they're communicating with the right client.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>Even more difficult than managing only server certificates.</li>
</ul>
<h3 id="hmac-over-http">HMAC over HTTP<a class="headerlink" href="#hmac-over-http" title="Permanent link">&para;</a></h3>
<p>An alternative approach is to use a <a href="https://en.wikipedia.org/wiki/HMAC">hash-based messaging code (HMAC)</a> to sign the request with a hash computed from the request's body and a private key.</p>
<p>Benefits:</p>
<ul>
<li>Prevents MITM attacks.</li>
<li>Traffic can be cached more easily than HTTPS traffic.</li>
<li>Usually the overhead of generating hashes is lower than the one caused by HTTPS.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>You need a way to share the secret key.</li>
<li>Hard to revoke the private key in case it's compromised.</li>
<li>It's a pattern, not a standard, so there are divergent ways to implement it.</li>
<li>Traffic is not encrypted.</li>
</ul>
<h3 id="api-keys">API Keys<a class="headerlink" href="#api-keys" title="Permanent link">&para;</a></h3>
<p>API keys allow a service to identify who is making a call, and place limits on what they can do.</p>
<p>Benefits:</p>
<ul>
<li>Easy to use for service-to-service authentication.</li>
</ul>
<p>Downsides:</p>
<ul>
<li>You need an API keys manager. Still, there are a lot of available tools.</li>
</ul>
<h2 id="the-deputy-problem">The deputy problem<a class="headerlink" href="#the-deputy-problem" title="Permanent link">&para;</a></h2>
<p>Having a principal authenticate with a given microservice is simple. But what happens if that service then needs to call more services to complete an operation?</p>
<p><img alt="Image" src="../images/deputy-problem.png" /></p>
<p>Without countermeasures, users can potentially trick the system into making calls to microservices that retrieve information they're not allowed to access (e.g. other users' data).</p>
<p>There is no simple answer to this problem. Depending on the sensitivity of the operation, you have different choices:</p>
<ul>
<li>Use an implicit trust model inside the microservices perimeter.</li>
<li>Verify the identity of the caller before accepting a request (this could add duplicate logic in your microservices).</li>
<li>Ask the caller to provide the credentials of the original principal.</li>
</ul>
<h2 id="securing-data-at-rest">Securing Data at Rest<a class="headerlink" href="#securing-data-at-rest" title="Permanent link">&para;</a></h2>
<p>It's important to carefully store data at rest to limit the damage if an attacker obtains access to it.c Some principles to observe:</p>
<ul>
<li>Use existing implementations of cryptographic algorithms.</li>
<li>Be careful how you manage your keys.</li>
<li>Identify sensitive data that should be encrypted and data that can be shown in logs.</li>
<li>Encrypt data when you first see it. Only decrypt it on demand.</li>
<li>Encrypt backups.</li>
</ul>
<h2 id="other-protections">Other protections<a class="headerlink" href="#other-protections" title="Permanent link">&para;</a></h2>
<p>There are other protective measures that you can apply to your system:</p>
<ul>
<li>Firewall.</li>
<li>Logging (but be careful of what you log!).</li>
<li>Intrusion detection systems.</li>
<li>Network segregation (e.g. put separate microservices in separate networks).</li>
</ul>
<p>Best practices:</p>
<ul>
<li>Keep your software updated and look out for new vulnerabilities.</li>
<li>Give the service user on the server OS as few permissions as possible.</li>
<li>Be frugal: collect only the data you need.</li>
</ul>
<h2 id="the-human-element">The Human Element<a class="headerlink" href="#the-human-element" title="Permanent link">&para;</a></h2>
<p>You may also need policies to deal with the human element in your organization:</p>
<ul>
<li>How do you revoke access to credentials when someone leaves the organization?</li>
<li>How can you protect yourself against social engineering?</li>
</ul>
<h2 id="baking-security-in">Baking Security In<a class="headerlink" href="#baking-security-in" title="Permanent link">&para;</a></h2>
<p>Helping educate developers about security concerns is key. Also, you can integrate automated vulnerabilities probing tools in your CI build.</p>
<p>But when in doubt, reach out to an expert for a thorough check of your system.</p>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Having a system decomposed into finer-grained services gives us many more options as to how to solve a problem. This concept applies to security too. So, while we have additional problems to solve (e.g. the deputy problem), we can apply a mix of known solutions to solve these problems.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../monitoring/" title="Monitoring" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Monitoring
              </span>
            </div>
          </a>
        
        
          <a href="../conway/" title="Conway's Law and System Desing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Conway's Law and System Desing
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/labarilem" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://www.linkedin.com/in/marcolabarile/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>