



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Notes about various topics, courses, books, etc.">
      
      
        <link rel="canonical" href="https://marcolabarile.me/notes/oauth2-and-openid-connect/oauth2/">
      
      
        <meta name="author" content="Marco Labarile">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon-16x16.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>OAuth 2.0 - Marco Labarile - Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../assets/styles/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-117745201-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#oauth-20" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://marcolabarile.me/notes/" title="Marco Labarile - Notes" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Marco Labarile - Notes
            </span>
            <span class="md-header-nav__topic">
              
                OAuth 2.0
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/labarilem/notes" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    labarilem/notes
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://marcolabarile.me/notes/" title="Marco Labarile - Notes" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Marco Labarile - Notes
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/labarilem/notes" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    labarilem/notes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      OAuth 2.0 and OpendID Connect
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        OAuth 2.0 and OpendID Connect
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../jwt/" title="JWT (JSON Web Token)" class="md-nav__link">
      JWT (JSON Web Token)
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        OAuth 2.0
      </label>
    
    <a href="./" title="OAuth 2.0" class="md-nav__link md-nav__link--active">
      OAuth 2.0
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#roles" class="md-nav__link">
    Roles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#endpoints" class="md-nav__link">
    Endpoints
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scopes" class="md-nav__link">
    Scopes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grants" class="md-nav__link">
    Grants
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorization-code-grant" class="md-nav__link">
    Authorization code grant
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proof-key-for-code-exchange-pkce" class="md-nav__link">
    Proof Key for Code Exchange (PKCE)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-credentials-grant" class="md-nav__link">
    Client credentials grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-authorization-grant" class="md-nav__link">
    Device authorization grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#refresh-token-grant" class="md-nav__link">
    Refresh token grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implicit-grant" class="md-nav__link">
    Implicit grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-grant" class="md-nav__link">
    Password grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-grant-should-you-use" class="md-nav__link">
    Which grant should you use?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vulnerabilities-and-attacks" class="md-nav__link">
    Vulnerabilities and Attacks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phishing-with-fake-consent-screens" class="md-nav__link">
    Phishing with fake consent screens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization-code-csrf" class="md-nav__link">
    Authorization Code CSRF
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implicit-grant-security-risks" class="md-nav__link">
    Implicit grant security risks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-resources" class="md-nav__link">
    More resources
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openid-connect/" title="OpenID Connect" class="md-nav__link">
      OpenID Connect
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Building microservices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Building microservices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/microservices/" title="Microservices" class="md-nav__link">
      Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/evolutionary-architects/" title="Evolutionary architects" class="md-nav__link">
      Evolutionary architects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/how-to-model-services/" title="How to model services" class="md-nav__link">
      How to model services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/integration/" title="Integration" class="md-nav__link">
      Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/splitting-the-monolith/" title="Splitting the monolith" class="md-nav__link">
      Splitting the monolith
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/conway/" title="Conway's Law and System Desing" class="md-nav__link">
      Conway's Law and System Desing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/microservices-at-scale/" title="Microservices at Scale" class="md-nav__link">
      Microservices at Scale
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices/conclusion/" title="Bringing It All Together" class="md-nav__link">
      Bringing It All Together
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Bitcoin and cryptocurrency technologies
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Bitcoin and cryptocurrency technologies
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/crypto-hash-functions/" title="Cryptographic hash functions" class="md-nav__link">
      Cryptographic hash functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/digital-signature/" title="Digital signature" class="md-nav__link">
      Digital signature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/hash-pointers-and-data-structures/" title="Hash pointers" class="md-nav__link">
      Hash pointers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/centralization-vs-decentralization/" title="Centralization and decentralization" class="md-nav__link">
      Centralization and decentralization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin-and-cryptocurrency-technologies/distributed-consensus/" title="Distributed consensus" class="md-nav__link">
      Distributed consensus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#roles" class="md-nav__link">
    Roles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#endpoints" class="md-nav__link">
    Endpoints
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scopes" class="md-nav__link">
    Scopes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grants" class="md-nav__link">
    Grants
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorization-code-grant" class="md-nav__link">
    Authorization code grant
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proof-key-for-code-exchange-pkce" class="md-nav__link">
    Proof Key for Code Exchange (PKCE)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-credentials-grant" class="md-nav__link">
    Client credentials grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#device-authorization-grant" class="md-nav__link">
    Device authorization grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#refresh-token-grant" class="md-nav__link">
    Refresh token grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implicit-grant" class="md-nav__link">
    Implicit grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-grant" class="md-nav__link">
    Password grant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-grant-should-you-use" class="md-nav__link">
    Which grant should you use?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vulnerabilities-and-attacks" class="md-nav__link">
    Vulnerabilities and Attacks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phishing-with-fake-consent-screens" class="md-nav__link">
    Phishing with fake consent screens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization-code-csrf" class="md-nav__link">
    Authorization Code CSRF
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implicit-grant-security-risks" class="md-nav__link">
    Implicit grant security risks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-resources" class="md-nav__link">
    More resources
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="oauth-20">OAuth 2.0<a class="headerlink" href="#oauth-20" title="Permanent link">&para;</a></h1>
<p>OAuth 2.0 is an open <em>framework</em> that allows to securely obtain <strong>authorization</strong> to access resources via HTTP.</p>
<p>For example, you can tell Google that Trello is allowed to access your Google Calendar in order to associate tasks with dates, <em>without sharing your Google password with Trello</em>. This is possible because Trello can send OAuth 2.0 tokens to Google which prove your consent.</p>
<p>OAuth 2.0 is not considered to be a <em>protocol</em> because the <a href="https://tools.ietf.org/html/rfc6749">specification</a> is rather vague. In fact, this is one of the reasons why Eran Hammer <a href="https://hueniverse.com/oauth-2-0-and-the-road-to-hell-8eec45921529">resigned</a> from his role of lead author for OAuth 2.0.</p>
<p>In the following sections we will go through the main concepts of the OAuth 2.0 framework.</p>
<h2 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h2>
<p>One of the best analogies is to consider an OAuth 2.0 token to be the <strong>valet key</strong> to your car. By using the valet key, the valet can start and move (for a limited distance) your car but he can't access the trunk.</p>
<p>An OAuth 2.0 token serves the same purpose of the valet key. As a resource owner, you decide which data each consumer is allowed to access from your service providers. You can give each consumer a different valet key, while being sure that none of these consumers has access to your full key or to any data from which they can build a full key.</p>
<h2 id="roles">Roles<a class="headerlink" href="#roles" title="Permanent link">&para;</a></h2>
<p>Roles identify the <em>actors</em> that can participate in OAuth 2.0 flows. There are 4 roles:</p>
<ul>
<li><strong>Resource Owner</strong>: the user who is giving authorization to access his account information.</li>
<li><strong>Client</strong>: the application that attempts to get access to the user's account. It needs the user's permission in order to get this access.</li>
<li><strong>Authorization Server</strong>: the server that allows users to approve or deny an authorization request.</li>
<li><strong>Resource Server</strong>: the server that consumes the user's information.</li>
</ul>
<p>This is how OAuth 2.0 roles would be translated in our example:</p>
<p><img alt="OAuth 2.0 roles example" class="center" src="../images/oauth2-roles.svg" /></p>
<h2 id="endpoints">Endpoints<a class="headerlink" href="#endpoints" title="Permanent link">&para;</a></h2>
<p>Endpoints are URIs that define the location of authorization services. In OAuth 2.0, there are 3 endpoints:</p>
<ul>
<li>The <strong>Authorization endpoint</strong> is on the authorization server. It's used for the resource owner's log in and grants authorization to the client application.</li>
<li>The <strong>Redirect endpoint</strong> is on the client application. The resource owner is redirected to this endpoint after having granted authorization at the authorization endpoint.</li>
<li>The <strong>Token endpoint</strong> is on the authorization server. This is where the client application exchanges some secret information for an access token.</li>
</ul>
<p>Note that some OAuth 2.0 grants don't involve all these endpoints but just some of them.</p>
<p>This is how the OAuth 2.0 endpoints would be translated in our Trello example:</p>
<p><img alt="OAuth 2.0 endpoints example" class="center" src="../images/oauth2-endpoints.svg" /></p>
<h2 id="scopes">Scopes<a class="headerlink" href="#scopes" title="Permanent link">&para;</a></h2>
<p>Scopes can be used to limit a client's access to the user's resources. Basically:</p>
<ol>
<li>A client can request one or more scopes.</li>
<li>The requested scopes are presented to the user in the consent screen.</li>
<li>If the user gives his consent, the access token issued to the application will be limited to those scopes.</li>
</ol>
<p>The OAuth 2.0 specification does not define any specific values for scopes, since they are highly dependent on the service provider. For example, these are the scopes for the Google Calendar's API:</p>
<p><img alt="OAuth 2.0 Google Calendar scopes" class="center" src="../images/oauth2-gcalendar-scopes.png" /></p>
<h2 id="grants">Grants<a class="headerlink" href="#grants" title="Permanent link">&para;</a></h2>
<p>Authorization grants are methods for a client to get an <strong>access token</strong>. The access token proves that a client has the permission to access the user's data.</p>
<p>Authorization grants are also known as <em>flows</em>.</p>
<p>OAuth 2.0 recommends to use one of the following grants:</p>
<ul>
<li><a href="#authorization-code-grant">Authorization code</a></li>
<li><a href="#proof-key-for-code-exchange-pkce">Authorization code with PKCE</a></li>
<li><a href="#client-credentials-grant">Client credentials </a></li>
<li><a href="#device-authorization-grant">Device authorization</a></li>
<li><a href="#refresh-token-grant">Refresh token</a></li>
</ul>
<p>But there are also some grants whose usage is discouraged by the <a href="https://tools.ietf.org/html/draft-ietf-oauth-security-topics-13">OAuth 2.0 Security Best Current Practice document</a>:</p>
<ul>
<li><a href="#implicit-grant">Implicit grant</a></li>
<li><a href="#password-grant-grant">Password grant</a></li>
</ul>
<h3 id="authorization-code-grant">Authorization code grant<a class="headerlink" href="#authorization-code-grant" title="Permanent link">&para;</a></h3>
<p>The <a href="https://tools.ietf.org/html/rfc6749#section-1.3.1">Authorization code grant</a> has been designed for clients which can securely store a client secret. This grant is typically used when the client is a web server.</p>
<p>Here's how the Authorization code grant would work in our Trello example:</p>
<p><img alt="OAuth 2.0 Authentication code grant" class="center" src="../images/oauth2-code-grant.svg" /></p>
<ol>
<li>The user clicks on a button in the Trello's web app in order to connect his Google account to Trello.</li>
<li>The Trello web app requests an authorization code. This operation can be done in several ways (e.g. redirection, link on HTML button). The code can be retrieved by making a HTTP GET request to the Google account's <em>authorization</em> endpoint with these parameters:<ul>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
<li><strong>response_type</strong>: specifies the grant type. By setting this parameter to <em>code</em>, the client indicates that it wants to start an authorization code grant.</li>
<li><strong>state</strong>: used to prevent <a href="#authorization-code-csrf">CSRF attacks</a>.</li>
<li><strong>redirect_uri</strong>: this is where the user will be sent after he approves the permission request.</li>
<li><strong>scope</strong>: describes the scope of the authorization (optional).</li>
</ul>
</li>
<li>The Google account server responds with the consent screen page.</li>
<li>The user examines the requested permissions in the consent screen and then gives consent to Trello.</li>
<li>The Google account server redirects the user to the <em>redirect_uri</em> on the client with these parameters:<ul>
<li><strong>code</strong>: the authorization code.</li>
<li><strong>state</strong>: the state that was previously set for this authorization request.</li>
</ul>
</li>
<li>Trello now has the authorization code and exchanges it for the access token to the user's Google account by making a HTTP POST request:<ul>
<li><strong>code</strong>: the authorization code.</li>
<li><strong>grant_type</strong>: specifies the grant type. By setting this parameter to <em>authorization_code</em>, the client indicates that it wants to complete an authorization code grant.</li>
<li><strong>redirect_uri</strong>: the uri where the authorization code has been previously sent.</li>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
<li><strong>client_secret</strong>: the private secret stored by the client. It was associated by the authorization server to the <em>client_id</em> when the client was registered.</li>
</ul>
</li>
<li>Trello uses the access token to create an event in the user's Google Calendar.</li>
</ol>
<p>You can try the Authorization code grant in the <a href="https://www.oauth.com/playground/authorization-code.html">OAuth.net playground</a>.</p>
<h4 id="proof-key-for-code-exchange-pkce">Proof Key for Code Exchange (PKCE)<a class="headerlink" href="#proof-key-for-code-exchange-pkce" title="Permanent link">&para;</a></h4>
<p><a href="https://tools.ietf.org/html/rfc7636">PKCE</a> extends the Authorization code grant to securely perform the code exchange with clients that cannot privately store the <em>authorization code</em>. This technique can be applied to any client, although it's typically used when the client is a mobile or a web browser application.</p>
<p>Here's how the Authorization code grant with PKCE would work in our Trello example:</p>
<p><img alt="OAuth 2.0 Authentication code PKCE" class="center" src="../images/oauth2-code-grant-pkce.svg" /></p>
<ol>
<li>The user clicks on a button in the Trello's web app in order to connect his Google account to Trello.</li>
<li>The Trello web app generates a <strong>code verifier</strong> (i.e. a cryptographically secure random string) and the respective <strong>code challenge</strong>, which can be an hash of the code verifier or the code verifier itself. This code must be saved in the web app for later use.</li>
<li>The Trello web app requests an authorization code. This operation can be done in several ways (e.g. redirection, link on HTML button). The code can be retrieved by making a HTTP GET request to the Google account's <em>authorization</em> endpoint with these parameters:<ul>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
<li><strong>response_type</strong>: specifies the grant type. By setting this parameter to <em>code</em>, the client indicates that it wants to start an authorization code grant.</li>
<li><strong>state</strong>: used to prevent <a href="#authorization-code-csrf">CSRF attacks</a>.</li>
<li><strong>redirect_uri</strong>: this is where the user will be sent after he approves the permission request.</li>
<li><strong>scope</strong>: describes the scope of the authorization (optional).</li>
<li><strong>code_challenge</strong>: used to send the code challenge previously generated by the Trello web app.</li>
<li><strong>code_challenge_method</strong>: if it's set to <em>S256</em>, indicates that the code verifier will be hashed with SHA256 and then base64-url-encoded into the code challenge. Otherwise, the secret code will be used as the code challenge.</li>
</ul>
</li>
<li>The Google account server responds with the consent screen page.</li>
<li>The user examines the requested permissions in the consent screen and then gives consent to Trello.</li>
<li>The Google account server redirects the user to the <em>redirect_uri</em> on the client with these parameters:<ul>
<li><strong>code</strong>: the authorization code.</li>
<li><strong>state</strong>: the state that was previously set for this authorization request.</li>
</ul>
</li>
<li>Trello now has the authorization code and exchanges it for the access token to the user's Google account by making a HTTP POST request:<ul>
<li><strong>code</strong>: the authorization code.</li>
<li><strong>grant_type</strong>: specifies the grant type. By setting this parameter to <em>code</em>, the client indicates that it wants to complete an authorization code grant.</li>
<li><strong>redirect_uri</strong>: the uri where the authorization code has been previously sent.</li>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
<li><strong>code_verifier</strong>: the code verifier that was initially generated by the Trello client. Google Account will check whether it matches the challenge that was specified by Trello in the authorization request. If an attacker intercepted the authorization code, it won't be able to exchange it for an access token.</li>
</ul>
</li>
<li>Trello uses the access token to create an event in the user's Google Calendar.</li>
</ol>
<p>You can try the Authorization code grant with PKCE in the <a href="https://www.oauth.com/playground/authorization-code-with-pkce.html">OAuth.net playground</a>.</p>
<h3 id="client-credentials-grant">Client credentials grant<a class="headerlink" href="#client-credentials-grant" title="Permanent link">&para;</a></h3>
<p>The <a href="https://tools.ietf.org/html/rfc6749#section-4.4">Client credentials grant</a> is used when clients need to be authorized to act on behalf of a <em>service account</em> rather than a human user.</p>
<p>For example, let's suppose that Trello has a system-internal service that computes statistics about users to create some reports. In order to do so, the Report service needs to be authorized to read the Trello users' data.
Here's how the client credentials grant would work in this example:</p>
<p><img alt="OAuth 2.0 Client credentials grant" class="center" src="../images/oauth2-client-credentials-grant.svg" /></p>
<ol>
<li>The Report service requests the access token that represents its service account by making a HTTP POST request:<ul>
<li><strong>grant_type</strong>: specifies the grant type. By setting this parameter to <em>client_credentials</em>, the client indicates that it wants to complete a client credentials grant.</li>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
<li><strong>client_secret</strong>: the private secret stored by the client. It was associated by the authorization server to the <em>client_id</em> when the client was registered.</li>
</ul>
</li>
<li>The Report service uses the access token to read the Trello users' data.</li>
</ol>
<h3 id="device-authorization-grant">Device authorization grant<a class="headerlink" href="#device-authorization-grant" title="Permanent link">&para;</a></h3>
<p>The <a href="https://tools.ietf.org/html/rfc8628">Device authorization grant</a> has been designed for devices with limited input capabilities.</p>
<p>For example, let's suppose we are using a Trello app for Apple TV and you want to authorize the app to access your Google Calendar's data.
Here's how the device authorization grant would work in this case:</p>
<p><img alt="OAuth 2.0 Device authorization grant" class="center" src="../images/oauth2-device-authorization-grant.svg" /></p>
<ol>
<li>The user clicks on a button in the Trello's web app in order to connect his Google account to Trello.</li>
<li>The Trello app requests a device code with a HTTP POST request to the <em>device</em> endpoint on the authorization server:<ul>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
</ul>
</li>
<li>The authorization server responds with the requested data:<ul>
<li><strong>device_code</strong>: a code representing the device, to be later displayed to the user.</li>
<li><strong>user_code</strong>: a code representing the user, to be later displayed to the user.</li>
<li><strong>verification_uri</strong>: represents the URL the user must visit to enter the user_code and device_code.</li>
<li><strong>interval</strong>: the minimum amount of time in seconds that the client should wait between polling requests to the token endpoint.</li>
<li><strong>expires_in</strong>: the lifetime in seconds of the device_code and user_code. (optional)</li>
</ul>
</li>
<li>The Trello app displays a message to the user, instructing him to visit the verification_url and the insert the user_code and device_code.</li>
<li>The user visits the verification_uri, then approves the authorization request by inserting the user_code and device_code.</li>
<li>While the Trello app was waiting for the user to approve the authorization request, it was polling the token endpoint with an HTTP POST request:<ul>
<li><strong>grant_type</strong>: set this parameter to <em>urn:ietf:params:oauth:grant-type:device_code</em> to complete a device authorization grant.</li>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
<li><strong>device_code</strong>: a code representing the device.</li>
</ul>
</li>
<li>After the user approved the request, the token endpoint responds with the access token.</li>
<li>The Trello app uses the access token to create an event in the user's Google Calendar.</li>
</ol>
<p>You can try the Device authorization grant in the <a href="https://www.oauth.com/playground/device-code.html">OAuth.net playground</a>.</p>
<h3 id="refresh-token-grant">Refresh token grant<a class="headerlink" href="#refresh-token-grant" title="Permanent link">&para;</a></h3>
<p>The <a href="https://tools.ietf.org/html/rfc6749#section-1.5">Refresh token grant</a> has been designed to exchange a <em>refresh token</em> for an expired access token.</p>
<p>Here's how this grant would work in our Trello example:</p>
<p><img alt="OAuth 2.0 Refresh token grant" class="center" src="../images/oauth2-refresh-token-grant.svg" /></p>
<ol>
<li>Trello requests the authorization server to refresh an expired token with a HTTP POST request:<ul>
<li><strong>grant_type</strong>: set this parameter to <em>refresh_token</em> to request a token refresh.</li>
<li><strong>refresh_token</strong>: refresh token. This token was initially returned by the authorization server alongside the access token.</li>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
<li><strong>client_secret</strong>: the private secret stored by the client. It was associated by the authorization server to the <em>client_id</em> when the client was registered. This parameter can be omitted if the client does not have a client secret.</li>
</ul>
</li>
<li>The token endpoint responds with the new access token. The response may not contain a new refresh token, meaning that the existing refresh token is still valid.</li>
<li>The Trello app uses the new access token to create an event in the user's Google Calendar.</li>
</ol>
<h3 id="implicit-grant">Implicit grant<a class="headerlink" href="#implicit-grant" title="Permanent link">&para;</a></h3>
<p>The <a href="https://tools.ietf.org/html/rfc6749#section-1.3.2">Implicit grant</a> has been designed to immediately return an access token to the client, without first performing a code exchange.</p>
<p>This grant was the recommended choice for native and JavaScript applications. But now <strong>its usage is discouraged</strong> because returning access tokens in a HTTP redirect brings several <a href="#implicit-grant-security-risks">security risks</a> to your application. These kinds of applications should instead use the Authorization code flow with PKCE.</p>
<p>Here's how the Implicit grant would work in our Trello example:</p>
<p><img alt="OAuth 2.0 Implicit grant" class="center" src="../images/oauth2-implicit-grant.svg" /></p>
<ol>
<li>The user clicks on a button in the Trello's web app in order to connect his Google account to the Trello web app.</li>
<li>The Trello web app requests the token by making a HTTP GET request to the Google account's <em>authorization</em> endpoint with these parameters:<ul>
<li><strong>client_id</strong>: the public id of the client. This was determined by the authorization server when the client was registered.</li>
<li><strong>response_type</strong>: specifies the grant type. By setting this parameter to <em>token</em>, the client indicates that it wants to use the implicit grant.</li>
<li><strong>state</strong>: used to prevent attackers from crafting redirect URLs with malicious tokens.</li>
<li><strong>redirect_uri</strong>: this is where the user will be sent after he approves the permission request.</li>
<li><strong>scope</strong>: describes the scope of the authorization (optional).</li>
</ul>
</li>
<li>The Google account server responds with the consent screen page.</li>
<li>The user examines the requested permissions in the consent screen and then gives consent to the Trello web app.</li>
<li>The Google account server redirects the user to the <em>redirect_uri</em> on the client. This URL uses the hash character (<em>#</em>) to specify parameters so that they are not sent to the server. These are the parameters received by the client:<ul>
<li><strong>access_token</strong>: the OAuth 2.0 access token.</li>
<li><strong>token_type</strong>: set to <em>Bearer</em> to indicate that the access token must be used with the Bearer scheme.</li>
<li><strong>expires_in</strong>: the lifespan of the access token.</li>
<li><strong>scope</strong>: describes the scope of the authorization (optional).</li>
<li><strong>state</strong>: the state that was previously set for this authorization request. The client needs to verify this match before using the access token to avoid malicious token injections.</li>
</ul>
</li>
<li>The Trello web app uses the access token to create an event in the user's Google Calendar.</li>
</ol>
<h3 id="password-grant">Password grant<a class="headerlink" href="#password-grant" title="Permanent link">&para;</a></h3>
<p>The <a href="https://tools.ietf.org/html/rfc6749#section-1.3.3">Password grant</a> has been designed to exchange the user's credentials for an access token. Since the client needs to read the password in cleartext, this grant should not be used at all. This is also stated in the latest <a href="https://tools.ietf.org/html/draft-ietf-oauth-security-topics-13#section-3.4">OAuth 2.0 Security Best Current Practice</a>.</p>
<h3 id="which-grant-should-you-use">Which grant should you use?<a class="headerlink" href="#which-grant-should-you-use" title="Permanent link">&para;</a></h3>
<p>Now we understand which are the the grant types in the OAuth 2.0 specification.</p>
<p>So, <em>which grant should you use for your application</em>?<br/>The following flow chart answer this question:</p>
<p><img alt="OAuth 2.0 Which grant to use" class="center" src="../images/oauth2-which-grant-to-use.svg" /></p>
<h2 id="vulnerabilities-and-attacks">Vulnerabilities and Attacks<a class="headerlink" href="#vulnerabilities-and-attacks" title="Permanent link">&para;</a></h2>
<p>There are some known attacks that can exploit vulnerable implementations of OAuth 2.0. In this section we will go through some of the most known OAuth 2.0 attacks.</p>
<h3 id="phishing-with-fake-consent-screens">Phishing with fake consent screens<a class="headerlink" href="#phishing-with-fake-consent-screens" title="Permanent link">&para;</a></h3>
<p>In some OAuth 2.0 grants, the user is redirected to a consent screen (e.g. the Google consent screen). How can the user be sure that he's actually dealing with a legitimate consent screen?
Some malicious apps may exploit this mechanism to make the user input his credentials in a fake, carefully crafted consent screen.</p>
<h3 id="authorization-code-csrf">Authorization Code CSRF<a class="headerlink" href="#authorization-code-csrf" title="Permanent link">&para;</a></h3>
<p>If applications don't use and validate <em>state</em> parameters they can be vulnerable to different types of attacks.</p>
<p>Let's suppose that Trello doesn't validate <em>state</em> parameters. Then, a malicious party would be able to carry out this <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF</a> attack:</p>
<ol>
<li>Alice visits the Trello app and clicks on the button to authorize access to Google Calendar.</li>
<li>Trello redirects Alice's browser to Google Account, requesting a redirect back to itself once Alice approves the authorization request.</li>
<li>Alice is redirected to the Google Account, where she enters her credentials in order to authorize access to the Trello application.</li>
<li>After a successful login, Alice prevents the subsequent redirect request and saves its URL (i.e. the callback URL with an authorizaiton code).</li>
<li>Alice somehow gets Bob to visit the redirect URL. Bob may already be logged in to Trello with his account.</li>
<li>Bob clicks the link to Trello and the authorization code is exchanged for an access token. If Bob is logged in then Trello may associate Bob's account with Alice's access token.</li>
<li>Now if Bob links a date to an item on his Trello account, Alice will be able to see that in her Google Calendar interface.</li>
</ol>
<p>In reality, Trello maintains and validates a <em>state</em> parameter. This means Trello would reject such requests even if Bob would inadvertently click on the URL sent by Alice.</p>
<h3 id="implicit-grant-security-risks">Implicit grant security risks<a class="headerlink" href="#implicit-grant-security-risks" title="Permanent link">&para;</a></h3>
<p>As of today, OAuth 2.0 discourages usage of the Implicit grant because of the following security risks:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc6749#section-10.3">Lack of confidentiality for access tokens</a></li>
<li><a href="https://tools.ietf.org/html/rfc6749#section-10.16">Misuse of access token to impersonate resource owner</a></li>
</ul>
<h2 id="more-resources">More resources<a class="headerlink" href="#more-resources" title="Permanent link">&para;</a></h2>
<p>If you want to learn more about OAuth 2.0, you can consult these resources:</p>
<ul>
<li><a href="https://aaronparecki.com/oauth-2-simplified">Aaron Parecki's blog</a></li>
<li><a href="https://oauth2simplified.com/">OAuth 2.0 Simplified, by Aaron Parecki</a></li>
<li><a href="https://www.oauth.com/playground/">OAuth.net Playground</a></li>
<li><a href="https://app.pluralsight.com/library/courses/oauth-2-getting-started/table-of-contents">Getting Started with OAuth 2.0, on Pluralsight</a> </li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../jwt/" title="JWT (JSON Web Token)" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                JWT (JSON Web Token)
              </span>
            </div>
          </a>
        
        
          <a href="../openid-connect/" title="OpenID Connect" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                OpenID Connect
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/labarilem" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://www.linkedin.com/in/marcolabarile/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>